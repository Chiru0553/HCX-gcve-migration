#################################### Nic - 3 #########################################

## Security zone t1-it-bo-prd-mtl-legacy  opt-local

## Create Palo Tier-1

resource "nsxt_policy_tier1_gateway" "legacy_nic3_router" {
  description           	= "Tier-1 Logical router for security zone it-bo-prd-mtl-legacy-opt-local"
  display_name          	= "t1-it-bo-prd-mtl-legacy-opt-local"
  nsx_id					= "t1-it-bo-prd-mtl-legacy-opt-local"
  edge_cluster_path     	= data.nsxt_policy_edge_cluster.edge-cluster.path
  failover_mode         	= "NON_PREEMPTIVE"
  default_rule_logging  	= "false"
  enable_firewall       	= "true"
  enable_standby_relocation = "false"
  		
  #tier0_path            	= data.nsxt_policy_tier0_gateway.tier0_gw_gateway.path
  #route_advertisement_types = ["TIER1_CONNECTED"]
  pool_allocation       	= "ROUTING"

  tag {
	scope = "security_zone"
	tag   = "t1-it-bo-prd-mtl-legacy-opt-local"
 }
 
  tag {
	scope = "firewall"
	tag   = "bo-legacy01"
 }

}

## Create Palo Segment

resource "nsxt_policy_segment" "legacy_nic3_router_segment" {
  display_name    	= "ls-gne1pc01-pa-legacy01-nic3"
  description     	= "Downlink segment for the security zone under FW-LEGACY-MONTREAL-11"
  #connectivity_path   = nsxt_policy_tier1_gateway.legacy_nic3_router.path
  transport_zone_path = data.nsxt_policy_transport_zone.overlay_tz.path

  discovery_profile {
    mac_discovery_profile_path = resource.nsxt_policy_mac_discovery_profile.macdiscovery_profile.path
  }
  advanced_config {
	connectivity    = "OFF"
  }
}



## Create Service Interface on PaloTier-1 to Palo Segment

resource "nsxt_policy_tier1_gateway_interface" "legacy_nic3_router_svcInterface" {
  display_name           = "legacy_nic3_router_svcInterface"
  description            = "Service Connection to Palo t1-it-bo-prd-mtl-legacy-opt-local"
  gateway_path           = nsxt_policy_tier1_gateway.legacy_nic3_router.path
  segment_path           = nsxt_policy_segment.legacy_nic3_router_segment.path
  subnets                = ["10.153.12.209/29"]
  #mtu                    = 1500
  #ipv6_ndra_profile_path = data.nsxt_policy_ipv6_ndra_profile.slaac.path
}


## Create Static Route on Palo Tier-1 to Palo VM using Service Interface

resource "nsxt_policy_static_route" "legacy_nic3_router_staticroute" {
  display_name = "legacy_nic3_router_staticroute"
  gateway_path = nsxt_policy_tier1_gateway.legacy_nic3_router.path
  network      = "0.0.0.0/0"

  next_hop {
    admin_distance = "1"
    ip_address     = "10.153.12.210"
	interface      =  nsxt_policy_tier1_gateway_interface.legacy_nic3_router_svcInterface.path
  }
  }

####################################### Nic - 4 ##############


## Security zone TAS-LEGACY-nonopt-local

## Create Palo Alto Tier-1

resource "nsxt_policy_tier1_gateway" "legacy_nic4_router" {
  description           	= "Tier-1 Logical router for security zone t1-lr-tas-legacy-nonopt-local"
  display_name          	= "t1-tas-legacy-nonopt-local"
  nsx_id					= "t1-tas-legacy-nonopt-local"
  edge_cluster_path     	= data.nsxt_policy_edge_cluster.edge-cluster.path
  failover_mode         	= "NON_PREEMPTIVE"
  default_rule_logging  	= "false"
  enable_firewall       	= "true"
  enable_standby_relocation = "false"
  
  # tier0_path            	= data.nsxt_policy_tier0_gateway.tier0_gw_gateway.path
  #route_advertisement_types = [ "TIER1_CONNECTED"]
  pool_allocation       	= "ROUTING"

  tag {
	scope = "security_zone"
	tag   = "t1-tas-legacy-nonopt-local"
 }
 
  tag {
	scope = "firewall"
	tag   = "Tas-legacy01"
 }
}


## Create Palo Segment

resource "nsxt_policy_segment" "legacy_nic4_router_segment" {
  display_name    	= "ls-gne1pc01-pa-legacy01-nic4"
  description     	= "Downlink segment for the security zone under FW-LEGACY-MONTREAL-1"
  #connectivity_path   = nsxt_policy_tier1_gateway.legacy_nic4_router.path
  transport_zone_path = data.nsxt_policy_transport_zone.overlay_tz.path

#  subnet {
#	cidr    	= "10.153.12.233/29" 
#	}
  discovery_profile {
    mac_discovery_profile_path = resource.nsxt_policy_mac_discovery_profile.macdiscovery_profile.path
  }
  advanced_config {
	connectivity    = "OFF"
  }

}

## Create Service Interface on PaloTier-1 to Palo Segment

resource "nsxt_policy_tier1_gateway_interface" "legacy_nic4_router_svcInterface" {
  display_name           = "legacy_nic4_router_svcInterface"
  description            = "Service Connection to TAS-LEGACY-nonopt-local"
  gateway_path           = nsxt_policy_tier1_gateway.legacy_nic4_router.path
  segment_path           = nsxt_policy_segment.legacy_nic4_router_segment.path
  subnets                = ["10.153.12.233/29"]
  #mtu                    = 1500
  #ipv6_ndra_profile_path = data.nsxt_policy_ipv6_ndra_profile.slaac.path
}


## Create Static Route on Palo Tier-1 to Palo VM using Service Interface

resource "nsxt_policy_static_route" "legacy_nic4_router_staticroute" {
  display_name = "legacy_nic4_router_staticroute"
  gateway_path = nsxt_policy_tier1_gateway.legacy_nic4_router.path
  network      = "0.0.0.0/0"

  next_hop {
    admin_distance = "1"
    ip_address     = "10.153.12.235"
	interface      =  nsxt_policy_tier1_gateway_interface.legacy_nic4_router_svcInterface.path
  }
  }
