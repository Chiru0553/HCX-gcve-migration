## Security zone ew-ebe-npd-mtl-shared-nonopt-ex


## Create Palo Tier-1

resource "nsxt_policy_tier1_gateway" "npd_nicx_router" {
  description           	= "Tier-1 Logical router for security zone ew-ebe-npd-mtl-shared-nonopt-ex "
  display_name          	= "t1-ew-ebe-npdx-mtl-shared-nonopt-ext"
  edge_cluster_path     	= data.nsxt_policy_edge_cluster.edge-cluster.path
  failover_mode         	= "NON_PREEMPTIVE"
  default_rule_logging  	= "false"
  enable_firewall       	= "true"
  enable_standby_relocation = "false"
#   tier0_path            	= data.nsxt_policy_tier0_gateway.tier0_gw_gateway.path
  #route_advertisement_types = [ "TIER1_CONNECTED"]
  pool_allocation       	= "ROUTING"

#  tag {
#	scope = "security_zone"
#	tag   = "t1-ew-ebe-npdx-mtl-shared-nonopt-ext"
#  }

}

## Create Palo Segment

resource "nsxt_policy_segment" "npd_nicx_router_segment" {
  display_name    	= "ls-gne1pc01-pa-npdx-nicx"
  description     	= "Downlink segment for the security zone under FW-NONPROD-MONTREAL-1"
  #connectivity_path   = nsxt_policy_tier1_gateway.npd_nic3_router.path
  transport_zone_path = data.nsxt_policy_transport_zone.overlay_tz.path

#  subnet {
#	cidr    	= "10.153.12.161/29"
#	}
}

## Create Service Interface on PaloTier-1 to Palo Segment

resource "nsxt_policy_tier1_gateway_interface" "npd_nicx_router_svcInterface" {
  display_name           = "npd_nicx_router_svcInterface"
  description            = "Service Connection to Palo t1-ew-ebe-npdx-mtl-shared-nonopt-ext"
  gateway_path           = nsxt_policy_tier1_gateway.npd_nicx_router.path
  segment_path           = nsxt_policy_segment.npd_nicx_router_segment.path
  subnets                = ["10.153.12.161/29"]
  mtu                    = 1500
  #ipv6_ndra_profile_path = data.nsxt_policy_ipv6_ndra_profile.slaac.path
}


## Create Static Route on Palo Tier-1 to Route traffic to Palo VM

resource "nsxt_policy_static_route" "npd_nicx_npdx_staticroute" {
  display_name = "npd_nicx_router_staticroute"
  gateway_path = nsxt_policy_tier1_gateway.npd_nicx_router.path
  network      = "0.0.0.0/0"

  next_hop {
    admin_distance = "1"
    ip_address     = "10.153.12.162"
	interface      =  nsxt_policy_tier1_gateway_interface.npd_nicx_router_svcInterface.path
  }
  }