resource "nsxt_policy_security_policy" "cn-backup" {
  display_name = "CN-Backup"
  description  = "Terraform provisioned Security Policy"
  category     = "Application"
  locked       = false
  stateful     = true
  tcp_strict   = false
  sequence_number = 1
  #scope        = [nsxt_policy_group.sg-backupinfra.path]

  rule {
    display_name       = "VM to NBU infra"
	source_groups      = [nsxt_policy_group.sg-backupsegments.path]
    destination_groups = [nsxt_policy_group.sg-backupinfra.path]
    action             = "ALLOW"
    services           = [nsxt_policy_service.cn-nbu.path,nsxt_policy_service.cn-nfs.path,nsxt_policy_service.cn-smb.path]
    logged             = false
	scope              = [nsxt_policy_group.sg-backupsegments.path]
  }
  
  rule {
    display_name       = "NBU to VM"
	source_groups      = [nsxt_policy_group.sg-backupinfra.path]
    destination_groups = [nsxt_policy_group.sg-backupsegments.path]
    action             = "ALLOW"
    services           = [nsxt_policy_service.cn-nbu.path]
    logged             = false
	scope              = [nsxt_policy_group.sg-backupsegments.path]
  }
  
  rule {
    display_name       = "Deny backup segment to any"
	source_groups      = []
    destination_groups = []
    action             = "DROP"
    services           = []
    logged             = false
	scope              = [nsxt_policy_group.sg-backupsegments.path]
  }


}

############### CN - Default dfw ##################

resource "nsxt_policy_security_policy" "cn-default" {
  display_name = "CN-Default"
  description  = "Terraform provisioned Security Policy"
  category     = "Application"
  locked       = false
  stateful     = false
  tcp_strict   = false
  sequence_number = 2
  #scope        = [nsxt_policy_group.sg-backupinfra.path]

  rule {
    display_name       = "Allow any segment to any"
	source_groups      = []
    destination_groups = []
    action             = "ALLOW"
    services           = []
    logged             = false
	scope              = []
  }
}